@import "tailwindcss";
@plugin './hero.ts';

@source '../node_modules/@heroui/theme/dist/**/*.{js,ts,jsx,tsx}';
@custom-variant dark (&:is(.dark *));

@theme {
    /* --- 1. Primitives --- */
    --u: 4px;
    --fz: 14px;
    --z: var(--tt-zoom-level, 1);
    --tt-uz: calc(var(--u) * var(--z));

    /* --- 2. Logical Roles (The Consistency Authority) --- */
    /* --- Panel spacing tiers (Tiered-Panel system) --- */
    --tt-p-tight: calc(var(--tt-uz) * 2); /* p-tight (old p-1/p-2) */
    --tt-p-panel: calc(
        var(--tt-uz) * 4
    ); /* p-panel (standard card/tab padding) */
    --tt-p-stage: calc(
        var(--tt-uz) * 6
    ); /* p-stage (headers, modals, major sections) */
    --tt-gap-stage: calc(var(--tt-uz) * 4); /* Gaps between panels */
    --tt-gap-tools: calc(var(--tt-uz) * 2); /* Gaps between controls */

    /* --- 3. Geometry Roles --- */
    --tt-h-nav: calc(var(--tt-uz) * 16);
    --tt-h-status: calc(var(--tt-uz) * 18);
    --tt-h-row: calc(var(--tt-uz) * 12);
    --tt-size-btn: calc(var(--tt-uz) * 8);
    --tt-size-btn-lg: calc(var(--tt-uz) * 10);

    /* --- 4. Mapping to Utilities --- */
    --spacing-panel: var(--tt-p-panel);
    --spacing-stage: var(--tt-p-stage);
    --spacing-tight: var(--tt-p-tight);
    --gap-stage: var(--tt-gap-stage);
    --gap-tools: var(--tt-gap-tools);
    /* Backward-compatible alias to map to Tailwind semantic spacing names */
    --spacing-tools: var(--tt-gap-tools);
    /* --- Column width tokens (Contextual Semantic Restoration) --- */
    --tt-w-col-id: calc(var(--tt-uz) * 12); /* w-12 -> id column */
    --tt-w-col-speed: calc(var(--tt-uz) * 24); /* w-24 -> speed column */
    --tt-w-col-client: calc(
        var(--tt-uz) * 28
    ); /* w-28 -> client identification column */

    /* --- Torrent table column topology (semantic, zoom-aware) --- */
    --tt-col-icon: calc(var(--tt-uz) * 12); /* icon / checkbox column */
    --tt-col-main: minmax(0, 1fr); /* fluid main column */
    --tt-col-meta: calc(var(--tt-uz) * 30); /* meta/right column */

    /* Friendly utility aliases */
    --w-col-id: var(--tt-w-col-id);
    --w-col-speed: var(--tt-w-col-speed);
    --w-col-client: var(--tt-w-col-client);
    /* (removed duplicate spacing-tight; authoritative value is --tt-p-tight above) */
    /* --- Forensic-mapped tokens (flagged items) --- */
    --tt-col-sparkline: calc(
        var(--tt-uz) * 16
    ); /* The w-16 found in ColumnDefinitions */
    --tt-h-indicator: calc(
        var(--tt-uz) * 3
    ); /* The h-3/h-4 for progress/skeletons */
    /* Modal structural elements */
    --tt-h-modal-header: var(--tt-h-nav); /* unify h-16 with h-nav */
    --tt-h-control-row: calc(
        var(--tt-uz) * 10
    ); /* The h-10 found in Settings */

    /* Visualization typography */
    --tt-fz-label: calc(var(--fz) * 1); /* ~10px equivalent relative to base */

    /* Navbar typography tokens (tab label and meta text) */
    --tt-navbar-tab-font-size: calc(var(--fz-scaled) * 1.5);
    --tt-navbar-meta-font-size: calc(var(--fz-scaled) * 1);

    /* Utility mapping aliases */
    --spacing-sparkline: var(--tt-col-sparkline);
    --spacing-indicator: var(--tt-h-indicator);
    --height-modal-header: var(--tt-h-modal-header);
    --height-control-row: var(--tt-h-control-row);
    --font-size-label: var(--tt-fz-label);
    --height-nav: var(--tt-h-nav);
    --height-status: var(--tt-h-status);
    --height-row: var(--tt-h-row);
    --size-btn: var(--tt-size-btn);
    --size-btn-lg: var(--tt-size-btn-lg);
}

/* Core design-system primitives and derived geometry
   - Minimal, authoritative primitives: --u, --fz, --z, --bw, --sw, --blur
   - All geometry is derived here. Components must use semantic roles or aliases.
   - Backward-compatible aliases kept, but DO NOT REDEFINE them elsewhere. */
:root {
    /* Structural fallbacks for layout tokens (prevents CLS/first-paint collapse) */
    --tt-zoom-level: 1; /* user scale multiplier (runtime) */
    --tt-unit-base: 4; /* spatial quantum (runtime) */
    --tt-font-base: 11; /* base font px (runtime) */

    /* Core law primitives (authoritative) */
    --u: calc(var(--tt-unit-base, 4) * 1px);
    --fz: calc(var(--tt-font-base, 11) * 1px);
    --z: var(--tt-zoom-level, 1);

    /* Semantic tracking tokens */
    --tt-tracking-tight: -0.01em;
    --tt-tracking-wide: 0.15em;
    --tt-tracking-ultra: 0.3em;

    /* Perceptual clamps (NOT linearly scaled) */
    --bw: 1px; /* border width — optical constant */
    --sw: 1.5; /* icon stroke base (unitless multiplier) */
    --blur: 18px; /* glass blur baseline (clamped) */

    /* Derived geometry (only from --u, --fz, --z) */
    --fz-scaled: calc(var(--fz) * var(--z));

    /* rows & rhythm */

    /* radii (optical — do NOT scale with --z) */
    --r-sm: 8px;
    --r-md: 16px;
    --r-lg: calc(6 * var(--u));

    /* icons follow typography (scaled) */
    --icon: calc(1.25 * var(--fz-scaled));
    --icon-lg: calc(1.6 * var(--fz-scaled));
    --tt-icon-size: var(--icon);

    /* perceptual non-linear outputs (clamped) */
    --stroke: clamp(1px, calc(var(--sw) * var(--z) * 1px), 2px);
    --glass-blur: clamp(14px, var(--blur), 22px);

    /* Semantic roles (derive only; do not introduce new numbers) */
    --button-min-w: calc(6 * var(--u) * var(--z));
    --table-font: var(--fz-scaled);

    /* Backward-compatible aliases (read-only; keep single source here) */
    --tt-unit: var(--u);
    --tt-font-size-base: var(--fz-scaled);
    --tt-row-h: var(--tt-h-row);
    --tt-navbar-h: var(--tt-h-nav);
    --tt-statusbar-h: var(--tt-h-status);
    --tt-navbar-padding: var(--p-3);
    --tt-navbar-gap: var(--p-2);
    --tt-brand-icon-size: calc(var(--icon) * 3);
    --tt-search-width: calc(40 * var(--u) * var(--z));

    --tt-status-icon-sm: calc(3 * var(--u) * var(--z));
    --tt-status-icon-md: calc(5 * var(--u) * var(--z));
    --tt-status-icon-lg: calc(8 * var(--u) * var(--z));
    --tt-status-icon-xl: calc(12 * var(--u) * var(--z));
    --tt-button-h: var(--tt-h-md);
    --tt-button-min-w: var(--button-min-w);

    --tt-file-row-padding-left: var(--p-2);
    --tt-file-depth-indent: calc(4 * var(--u) * var(--z));
    --tt-file-context-menu-width: calc(55 * var(--u) * var(--z));
    --tt-file-context-menu-margin: var(--p-2);
    --tt-priority-badge-font-size: var(--fz-scaled);
    --tt-priority-badge-padding-x: var(--p-2);
    --tt-priority-badge-padding-y: var(--p-1);
    --tt-file-icon-size: calc(4 * var(--u) * var(--z));
    --tt-file-checkbox-padding: var(--p-1);

    /* Added semantic tokens for previously inline arbitrary Tailwind calcs */
    --tt-modal-max-width: calc(180 * var(--u) * var(--z));
    --tt-modal-body-max-height: calc(70 * var(--u) * var(--z));
    --tt-modal-add-w: calc(var(--u) * 180 * var(--z));
    --tt-modal-body-max-h: calc(var(--u) * 70 * var(--z));
    --tt-modal-settings-h: calc(var(--u) * 200 * var(--z));
    --tt-modal-settings-min-h: calc(var(--u) * 125 * var(--z));
    --tt-settings-h: calc(200 * var(--u));
    --tt-settings-max-h: calc(200 * var(--u));
    --tt-settings-min-h: calc(125 * var(--u));
    --tt-badge-min-width: calc(15 * var(--u) * var(--z));
    --tt-divider-width: calc(2 * var(--bw));
    --tt-peers-hud-height: calc(45 * var(--u) * var(--z));
    --tt-directory-picker-max-w: calc(40 * var(--u) * var(--z));
    --tt-shell-accent-large: calc(120 * var(--u) * var(--z));
    --tt-shell-accent-medium: calc(100 * var(--u) * var(--z));
    --tt-shell-main-max-w: calc(350 * var(--u) * var(--z));
    --tt-statusbar-short-max-w: calc(12 * var(--u) * var(--z));
    --tt-track-h: calc(2 * var(--bw));
    --tt-command-palette-max-h: calc(80 * var(--u) * var(--z));
    /* Additional semantic tokens for previously static utilities */
    /* Consolidated height tokens (single source of truth) */
    --tt-h-lg: calc(64 * var(--u) * var(--z));
    --tt-h-md: calc(12 * var(--u) * var(--z));
    --tt-h-sm: calc(8 * var(--u) * var(--z));
    --tt-dot-size: calc(1.5 * var(--u) * var(--z));
    --tt-tracker-name-max-w: calc(45 * var(--u) * var(--z));

    /* Backward-compatible aliases (components will be migrated gradually) */
    --tt-dir-list-h: var(--tt-h-lg);
    --tt-list-item-h: var(--tt-h-md);
    --tt-skeleton-h: var(--tt-h-md);
    --tt-sep-h: var(--tt-h-sm);
    --tt-sep-sm: calc(6 * var(--u) * var(--z));
    /* expose friendly aliases */
    --tt-size-icon-btn: var(--tt-size-icon-btn);
    --size-icon-btn: var(--tt-size-icon-btn);
    --size-icon-btn-lg: var(--tt-size-icon-btn-lg);
}

/* index.css - AGGRESSIVE TUNING FOR VISIBILITY */
@layer components {
    main [data-slot="input-wrapper"],
    main [data-slot="trigger"],
    main [data-slot="inner-wrapper"] {
        background-color: hsl(var(--heroui-content1)) !important;
    }
}

@layer components {
    button:not(:disabled) {
        transition: transform 0.16s ease, filter 0.16s ease;
        transform-origin: center center;
        will-change: transform, filter;
        touch-action: manipulation;
    }

    button:not(:disabled):active {
        transform: scale(0.96);
        filter: brightness(1.08);
    }
}

@layer utilities {
    .pressable-row {
        cursor: pointer;
        transition: transform 0.15s ease, filter 0.15s ease;
        transform-origin: center center;
        will-change: transform, filter;
    }

    /* Torrent table grid topology bridge (single class) */
    .grid-cols-torrent {
        grid-template-columns: var(--tt-col-icon) var(--tt-col-main) var(
                --tt-col-meta
            );
    }

    .pressable-row:active {
        transform: translateY(1px) scale(0.98);
        filter: brightness(1.08);
    }

    .pressable-tab {
        transition: transform 0.12s ease, filter 0.12s ease;
        transform-origin: center center;
        will-change: transform, filter;
    }

    .pressable-tab:active {
        transform: scale(0.92);
        filter: brightness(1.1);
    }

    /* Forensic: semantic replacements for banned arbitrary Tailwind brackets */
    .tracking-0-2 {
        letter-spacing: var(--tt-tracking-wide);
    }
    .tracking-0-3 {
        letter-spacing: var(--tt-tracking-ultra);
    }
    .tt-navbar-tab-font {
        font-size: var(--tt-navbar-tab-font-size);
    }
    .tt-navbar-meta-font {
        font-size: var(--tt-navbar-meta-font-size);
    }
    .toolbar-icon-size-sm {
        width: var(--tt-status-icon-sm);
        height: var(--tt-status-icon-sm);
    }
    .toolbar-icon-size-md {
        width: var(--tt-status-icon-md);
        height: var(--tt-status-icon-md);
    }
    .toolbar-icon-size-lg {
        width: var(--tt-status-icon-lg);
        height: var(--tt-status-icon-lg);
    }
    .toolbar-icon-size-xl {
        width: var(--tt-status-icon-xl);
        height: var(--tt-status-icon-xl);
    }
    .window-control-button-width {
        width: var(--tt-navbar-h);
    }
    /* Semantic role for label tracking (use in components via logic export) */
    .tracking-label {
        letter-spacing: var(--tt-tracking-ultra);
    }
    .tracking-0-4 {
        letter-spacing: var(--tt-tracking-ultra);
    }

    .blur-glass {
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
    }

    .bg-noise {
        background-image: url("https://grainy-gradients.vercel.app/noise.svg");
        background-repeat: no-repeat;
        background-size: cover;
    }

    .z-top {
        z-index: 12000;
    }

    .shadow-success-glow {
        box-shadow: 0 0 20px -5px rgba(var(--heroui-success-500), 0.2);
    }
    .shadow-danger-glow {
        box-shadow: 0 0 20px -5px rgba(var(--heroui-danger-500), 0.2);
    }
    .shadow-visual-large {
        box-shadow: 0 25px 75px rgba(0, 0, 0, 0.35);
    }
    .shadow-menu-large {
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
    }
    .shadow-dot {
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.25);
    }
    .shadow-availability {
        box-shadow: 0 0 25px rgba(14, 165, 233, 0.25);
    }
    .shadow-context {
        box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
    }

    .drop-shadow-primary-small {
        filter: drop-shadow(0 0 2px rgba(var(--heroui-primary-500), 0.3));
    }

    .opacity-03 {
        opacity: 0.03;
    }

    .scale-98 {
        transform: scale(0.98);
    }

    .max-w-tracker-name {
        max-width: var(--tt-tracker-name-max-w);
    }
    .min-w-dir-picker {
        min-width: var(--tt-directory-picker-max-w);
    }

    .max-w-tooltip {
        max-width: var(--tt-modal-max-width);
    }

    .max-w-modal-add {
        max-width: var(--tt-modal-add-w);
    }

    .max-h-modal-body {
        max-height: var(--tt-modal-body-max-h);
    }

    .min-w-status-chip {
        min-width: var(--tt-badge-min-width);
    }

    .rounded-modal {
        border-radius: var(--r-lg);
    }

    .icon-size {
        width: var(--tt-icon-size);
        height: var(--tt-icon-size);
    }

    .icon-size-lg {
        width: var(--icon-lg);
        height: var(--icon-lg);
    }

    /* LIGHT - emerald paper */
    .texture-emerald {
        /* base from HeroUI theme */
        background-color: hsl(var(--heroui-background)) !important;

        background-image:
      /* soft emerald glow top-left */ radial-gradient(
                circle at 0% 0%,
                rgba(0, 159, 107, 0.65) 0,
                transparent 52%
            ),
            /* softer emerald glow bottom-right */
                radial-gradient(
                    circle at 100% 100%,
                    rgba(0, 159, 107, 0.8) 0,
                    transparent 58%
                ),
            /* gentle vertical depth – much less white now */
                linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.55) 0%,
                    rgba(255, 255, 255, 0.18) 40%,
                    rgba(0, 0, 0, 0.02) 100%
                ),
            /* very faint diagonal grid */
                linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.04) 1px,
                    transparent 1px
                ),
            linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px
            );

        background-repeat: no-repeat, no-repeat, no-repeat, repeat, repeat;

        background-size: 135% 135%, /* radial 1 */ 135% 135%,
            /* radial 2 */ 100% 100%, /* vignette */ 72px 72px,
            /* grid 1 */ 72px 72px;
        /* grid 2 */

        background-attachment: fixed;
    }

    /* DARK – graphite with emerald accent */
    .dark .texture-emerald {
        background-color: hsl(var(--heroui-background)) !important;

        background-image:
      /* emerald glow top-left */ radial-gradient(
                circle at 0% 0%,
                rgba(0, 223, 162, 0.3) 0,
                transparent 45%
            ),
            /* emerald glow bottom-right */
                radial-gradient(
                    circle at 100% 100%,
                    rgba(0, 223, 162, 0.15) 0,
                    transparent 50%
                ),
            /* darker vignette than before – less “foggy” */
                linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.015) 0,
                    rgba(0, 0, 0, 0.85) 100%
                ),
            /* subtle graphite grid */
                linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.035) 1px,
                    transparent 1px
                ),
            linear-gradient(45deg, rgba(0, 0, 0, 0.45) 1px, transparent 1px);

        background-repeat: no-repeat, no-repeat, no-repeat, repeat, repeat;

        background-size: 140% 140%, 140% 140%, 100% 100%, 72px 72px, 72px 72px;

        background-attachment: fixed;
    }
}

/* "Stealth" Scrollbar */
.scrollbar-hide::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.scrollbar-hide::-webkit-scrollbar-track {
    background: transparent;
}

.scrollbar-hide::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.scrollbar-hide::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.2);
}

:root {
    --app-scrollbar-thumb: rgba(255, 255, 255, 0.18);
    --app-scrollbar-thumb-hover: rgba(255, 255, 255, 0.35);
}

@layer base {
    html {
        font-size: var(--tt-font-size-base);
    }

    :root[data-native-host="true"],
    :root[data-native-host="true"] body {
        background-color: transparent;
        background-image: none;
    }

    :root[data-native-host="true"] .tt-app-shell {
        background-color: transparent;
        background-image: none;
    }

    :root[data-native-host="true"] .tt-shell-body {
        padding: 0;
        margin: 0;
    }

    :root[data-native-host="true"] .tt-shell-no-drag {
        -webkit-app-region: no-drag;
    }

    :root[data-native-host="true"] .tt-shell-body > .acrylic,
    :root[data-native-host="true"] .tt-shell-body > .tt-shell-no-drag.acrylic {
        border-color: transparent;
        box-shadow: none;
    }
}

@layer utilities {
    :root[data-native-host="true"] .tt-app-shell {
        background-color: transparent !important;
        background-image: none !important;
    }
}

@layer components {
    .glass-panel {
        position: relative;
        overflow: hidden;
        border-radius: inherit;
        background-clip: padding-box;
    }

    .native-shell-body {
        @apply bg-background/60 backdrop-blur-3xl border border-transparent;
    }

    .native-shell-inner {
        background-color: transparent;
        border-color: transparent;
        box-shadow: none;
    }

    .native-shell-main {
        background-color: transparent;
        border-color: transparent;
        box-shadow: none;
    }

    .surface-layer-0 {
        background-color: var(--heroui-background);
        border: 1px solid
            color-mix(in srgb, var(--heroui-default) 20%, transparent 80%);
        background-image: radial-gradient(
                circle at 18% 25%,
                color-mix(in srgb, var(--heroui-content1) 25%, transparent 75%),
                transparent 50%
            ),
            radial-gradient(
                circle at 80% 10%,
                color-mix(
                    in srgb,
                    var(--heroui-foreground) 15%,
                    transparent 85%
                ),
                transparent 60%
            ),
            repeating-linear-gradient(
                135deg,
                transparent 0,
                transparent 8px,
                color-mix(in srgb, var(--heroui-foreground) 6%, transparent 94%)
                    8px,
                color-mix(in srgb, var(--heroui-foreground) 6%, transparent 94%)
                    9px
            );
        background-blend-mode: screen;
    }

    .surface-layer-1 {
        @apply border border-default/10 bg-background/60 backdrop-blur-md;
    }

    .surface-layer-2 {
        @apply border border-default/20 bg-content1/80 backdrop-blur-2xl;
    }

    .inspector-shell {
        border-radius: 20px;
        border: 1px solid
            color-mix(in srgb, var(--heroui-default), transparent 60%);
        background-color: color-mix(
            in srgb,
            var(--heroui-content1) 90%,
            transparent 10%
        );
        backdrop-filter: blur(24px);
        box-shadow: 0 35px 60px rgba(0, 0, 0, 0.45);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        background-clip: padding-box;
    }
}

@layer components {
    .torrent-table-watermark {
        background-image: url("/tinyTorrent.svg");
        background-repeat: no-repeat;

        /* 25% of container height */
        background-size: auto 70%;

        /* right edge, and 5% up from the bottom */
        background-position: right 5% bottom 15%;

        transition: opacity 1.25s ease;
    }

    @media (max-width: 960px) {
        .torrent-table-watermark {
            background-size: 48vw;
            background-position: center 88%;
        }
    }

    @media (max-width: 600px) {
        .torrent-table-watermark {
            background-size: 62vw;
            background-position: center 92%;
        }
    }
}

@layer utilities {
    .cap-height-text {
        line-height: 1;
        transform: translateY(-0.75px);
    }

    /* Semantic square size utilities (use these to ensure perfect squares driven by CSS tokens) */
    .size-icon-btn {
        height: var(--size-icon-btn);
        width: var(--size-icon-btn);
    }

    .size-icon-btn-lg {
        height: var(--size-icon-btn-lg);
        width: var(--size-icon-btn-lg);
    }

    .size-dot {
        height: var(--tt-dot-size);
        width: var(--tt-dot-size);
    }

    /* Semantic text sizing utility mapping to scaled font variable */
    .text-scaled {
        font-size: var(--tt-font-size-base);
    }

    :where(body, .overlay-scrollbar) {
        scrollbar-width: thin;
        scrollbar-color: transparent transparent;
        scrollbar-gutter: stable both-edges;
    }

    :where(body, .overlay-scrollbar)::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    :where(body, .overlay-scrollbar)::-webkit-scrollbar-track {
        background: transparent;
    }

    :where(body, .overlay-scrollbar)::-webkit-scrollbar-thumb {
        background: var(--app-scrollbar-thumb);
        border-radius: 999px;
        border: 1px solid transparent;
        min-height: 24px;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
        transition: background 0.2s ease, transform 0.2s ease, opacity 0.2s ease;
        transform-origin: center;
        opacity: 0;
        transform: scaleY(0.6);
    }

    :where(body, .overlay-scrollbar):not(:hover)::-webkit-scrollbar-thumb {
        opacity: 0;
        transform: scaleY(0.5);
    }

    :where(body, .overlay-scrollbar):hover::-webkit-scrollbar-thumb,
    :where(body, .overlay-scrollbar):focus-within::-webkit-scrollbar-thumb {
        width: 8px;
        background: var(--app-scrollbar-thumb-hover);
        opacity: 1;
        transform: scaleY(1.05);
    }

    :where(body, .overlay-scrollbar)::-webkit-scrollbar-thumb:hover {
        transform: scaleY(1.15);
    }

    :where(body, .overlay-scrollbar)::-webkit-scrollbar-corner {
        background: transparent;
    }
}

/* Windows 11 Acrylic Utility */
.acrylic {
    @apply backdrop-blur-3xl bg-background/70 relative overflow-hidden;
    /* The "grain" texture that defines Acrylic material */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
}

.torrent-table-watermark {
    mix-blend-mode: soft-light;
    opacity: 0.25; /* Slightly higher opacity to help color pop in the corner */
    filter: brightness(1.2) saturate(1.2);
    pointer-events: none;

    background-image: url("/tinyTorrent.svg");
    background-repeat: no-repeat;

    /* POSITION: Bottom Right with 40px padding from the edges */
    background-position: right 40px bottom 40px;

    /* SIZE: Slightly smaller looks better in the corner than centered */
    background-size: 250px;
}
/* Adjust watermark when inside the Immersive Main container */
main .torrent-table-watermark {
    mix-blend-mode: soft-light;
    opacity: 0.25; /* Slightly higher opacity to help color pop in the corner */
    filter: brightness(1.2) saturate(1.2);
    pointer-events: none;

    background-image: url("/tinyTorrent.svg");
    background-repeat: no-repeat;

    /* POSITION: Bottom Right with 40px padding from the edges */
    background-position: right 40px bottom 40px;

    /* SIZE: Slightly smaller looks better in the corner than centered */
    background-size: 250px;
}

/* Semantic utility aliases to satisfy Design System: expose role-named classes
   These keep markup concise (gap-tools, p-panel, p-tight, h-row, h-sep, etc.)
   and hide var() math in CSS only (Zero-Bracket Policy).
*/
@layer utilities {
    .gap-tools {
        gap: var(--spacing-tools);
    }
    .gap-tight {
        gap: var(--spacing-tight);
    }

    .gap-stage {
        gap: var(--gap-stage);
    }

    .p-panel {
        padding: var(--spacing-panel);
    }

    .p-tight {
        padding: var(--spacing-tight);
    }

    .px-panel {
        padding-left: var(--spacing-panel);
        padding-right: var(--spacing-panel);
    }

    .py-panel {
        padding-top: var(--spacing-panel);
        padding-bottom: var(--spacing-panel);
    }

    .px-tight {
        padding-left: var(--spacing-tight);
        padding-right: var(--spacing-tight);
    }

    .py-tight {
        padding-top: var(--spacing-tight);
        padding-bottom: var(--spacing-tight);
    }

    .rounded-panel {
        border-radius: var(--r-md);
    }

    .h-sep {
        height: var(--tt-h-sm);
    }

    .h-row {
        height: var(--tt-h-row);
    }

    .h-lg {
        height: var(--tt-h-lg);
    }

    .h-indicator {
        height: var(--tt-h-indicator);
    }

    .h-md {
        height: var(--tt-h-md);
    }
    .h-track {
        height: var(--tt-track-h);
    }

    .h-track {
        height: var(--tt-track-h);
    }

    .h-peers-hud {
        height: var(--tt-peers-hud-height);
    }

    /* Additional semantic utilities for remaining token mappings */
    .h-sep {
        height: var(--tt-h-sm);
    }

    .h-button {
        height: var(--button-h);
    }

    .h-settings {
        height: var(--tt-settings-h);
    }

    .max-h-settings {
        max-height: var(--tt-settings-max-h);
    }

    .min-h-settings {
        min-height: var(--tt-settings-min-h);
    }

    .max-w-dir-picker {
        max-width: var(--tt-directory-picker-max-w);
    }

    .max-h-command-palette {
        max-height: var(--tt-command-palette-max-h);
    }

    /* Column width utilities (Contextual Semantic Restoration) */
    .w-col-id {
        width: var(--w-col-id);
    }

    .w-col-speed {
        width: var(--w-col-speed);
    }

    .w-col-client {
        width: var(--w-col-client);
    }

    /* Sparkline width utility */
    .w-sparkline {
        width: var(--tt-col-sparkline);
    }

    .h-shell-accent-large {
        height: var(--tt-shell-accent-large);
    }

    .h-shell-accent-medium {
        height: var(--tt-shell-accent-medium);
    }

    /* Consolidated label typography */
    .text-label {
        font-size: var(--font-size-label);
        line-height: 1;
    }

    /* Shadow tokens for HUD and nav to avoid arbitrary bracket shadows */
    .shadow-hud {
        box-shadow: 0 35px 60px rgba(0, 0, 0, 0.45);
    }

    .shadow-nav {
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.28);
    }
    .h-peers-hud {
        height: var(--tt-peers-hud-height);
    }
}

@layer utilities {
    /* CRITICAL: Defines the draggable area for the frameless window */
    .app-titlebar {
        -webkit-app-region: drag;
        user-select: none;
        position: relative;
        z-index: 50;
    }

    /* CRITICAL: Interactive elements inside the titlebar must NOT drag */
    .app-titlebar button,
    .app-titlebar input,
    .app-titlebar .no-drag {
        -webkit-app-region: no-drag;
    }
}
